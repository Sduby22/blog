+++
title = "Build a website with Hugo & Github Pages & Cloudflare"
author = ["Sduby"]
date = 2022-07-06T17:09:00+08:00
tags = ["hugo", "blog"]
draft = false
summary = "Build a website with Hugo+Github Pages+Cloudflare"
+++

## Introduction {#introduction}

In this post, we use:

-   Hugo + Markdown for static blog site building.
-   Github Pages for Deployment
-   Cloudflare for a CDN acceleration (needs a domain)

Please take a look at the TOC for steps of configuration.


## Building the Static Site with Hugo {#building-the-static-site-with-hugo}

Hugo is a static website generator. In a nutshell, it parses your markdown file, add some themes/styles to it, and compiles to a pack of html/css/js files for deployment.


### Getting Started with Hugo {#getting-started-with-hugo}

You can follow [this guide](https://gohugo.io/getting-started/quick-start/) to set up hugo locally.


### Maybe Change your Config to YAML? (Optional) {#maybe-change-your-config-to-yaml--optional}

Hugo uses `config.yoml` or `config.yaml` for config file. IMO I think `yaml` is more readable than `toml`, so I'd like to convert the auto-generated toml file to `config.yaml`. You can also do that with some random online converter found on Google.

Because I use `yaml`, all the config examples in this posts is in yaml. If you want to use `toml`, don't just copy paste, do the convertion yourself.


### Pick your Favorite Theme (Optional) {#pick-your-favorite-theme--optional}

[Complete List | Hugo Themes](https://themes.gohugo.io/)


### Modify the Config {#modify-the-config}

open `config.yaml`, there are some important fields to modify.

```yaml
baseURL: 'https://chocole.top/' # Change this
buildDrafts: true
title: "Random Notes"
Params:
  env: production
```

In config file, you also set up some theme specific settings, like TOC toggles. Go to your theme repo for detail.

We'll go back to `baseURL` option later.


### Try Building the Site Locally {#try-building-the-site-locally}

Run `hugo server` in your root dir to test if everything goes well.


## Deploy Your Site to Github Pages {#deploy-your-site-to-github-pages}

How does Github Pages work? In a nutshell, it pulls your repo and hosts the files in it. So if you create a repo and push all the html/css/js files generated by hugo, then your github pages is set up.

But for convenience sake, we can invoke `Github Action` for automatic building &amp; deploy. The blogging flow truns into:

-   Write posts in md and put them into `contents/posts` folder in your hugo dir.
-   Commit and push them to `master` branch of the remote github repo.
-   Pushing to `master` branch triggers the Github Action.
-   a worker machine runs `hugo` to build md to html, then push the generated files to a new branch `gh-pages`.
-   Github Pages can now host the site with the files in branch `gh-pages`.


### Create a Github Repo {#create-a-github-repo}

Create your blog repo and push everything except the `public` folder (if exists) in it. The public folder contains the generated html file and we actually don't need them and they can be safely deleted.


### Set up Github Action {#set-up-github-action}

In your repo root dir, create `.github/workflows/gh-pages.yml`, paste this:

```yml
name: GitHub Pages

on:
  push:
    branches:
      - master  # Change this to your branch name (master/main)
  pull_request:

jobs:
  deploy:
    runs-on: ubuntu-20.04
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true
          fetch-depth: 0

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: '0.101.0' # You can set your hugo version, check with `hugo version`
          extended: true

      - name: Build
        run: hugo --minify

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        if: ${{ github.ref == 'refs/heads/master' }} # Change this to master/main
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          cname: chocole.top # If you dont want to use a custom domain, delete this line.
```

There're some important settings so make sure you read the comment.


### Test the Action {#test-the-action}

Write some new random md files and push to your master branch, you can see if the github action succeeds in the repo page. If everything goes well, a new branch called `gh-pages` should appear, in which contains the generated html/css/js files.


### Enable Github Pages in Repo Settings. {#enable-github-pages-in-repo-settings-dot}

Enable Github Pages by setting the page branch to gh-pages. You should see your custom domain if you set the `cname` field in step [Set up Github Action](#set-up-github-action)

{{< figure src="/ox-hugo/_20220706_164933screenshot.png" >}}

If you choose not to use a custom domain, your site show now be accessible via that URL.


## Use Cloudflare to Accelerate your Site {#use-cloudflare-to-accelerate-your-site}


### Create a new website in cf dashboard {#create-a-new-website-in-cf-dashboard}

Create a new website in cf dashboard and select the free plan.


### Configure the DNS server on your Domain Provider Side {#configure-the-dns-server-on-your-domain-provider-side}

If your domain is not from cf, then you have to do this. Follow the instructions on the cf "Overview" page.


### Add CNAME DNS records {#add-cname-dns-records}

change the domain names to your domains.
![](/ox-hugo/_20220706_170037screenshot.png)


### Always Use HTTPS {#always-use-https}

cf Dashboard -- SSL/TLS -- Edge Certificates -- Always Use HTTPS


## Conclusion {#conclusion}

For CF users you have to wait for DNS server updates and Edge Certificates Activation. In 24 hours you should have access to you new site.


### FAQ {#faq}

1.  Q: The website is accessible, but the layout is broken.

    A: Check `baseURL` in [Modify the Config](#modify-the-config)
